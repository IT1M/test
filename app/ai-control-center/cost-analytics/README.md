# Cost & Performance Analytics

## Overview

The Cost & Performance Analytics page provides comprehensive tools for monitoring, analyzing, and optimizing AI spending and performance. This implementation addresses requirements 23.55-23.62 from the medical archive system specification.

## Features Implemented

### 1. Cost Dashboard (Requirement 23.55)
- **Total Cost Tracking**: Displays total AI costs for selected time period (7d, 30d, 90d)
- **Budget Monitoring**: Shows budget usage percentage with visual indicators
- **Projected Costs**: Calculates and displays projected month-end costs
- **Potential Savings**: Aggregates all optimization recommendations

### 2. Cost Breakdown Charts (Requirement 23.56)
- **By Operation Type**: Bar chart showing costs grouped by operation (classify, extract, analyze, etc.)
- **By Model**: Pie chart with detailed breakdown of costs per AI model
- **By Time Period**: Area chart showing daily cost trends with API call volume overlay
- **Detailed Tables**: Interactive tables with cost per call metrics

### 3. Budget Tracking Widget (Requirement 23.57)
- **Visual Indicators**: Color-coded progress bars (green < 75%, yellow 75-90%, red > 90%)
- **Budget Alerts**: Automatic alerts when approaching thresholds
- **Projections**: Month-end cost projections based on current usage patterns
- **Configurable Thresholds**: Ability to set custom alert thresholds

### 4. Cost Optimization Engine (Requirement 23.58)
- **AI-Powered Recommendations**: Analyzes usage patterns to suggest optimizations
- **Categorized Suggestions**: 
  - Cache optimizations (increase TTL for stable queries)
  - Batch processing (reduce overhead costs)
  - Model selection (use lighter models for simple tasks)
  - Threshold adjustments (optimize confidence thresholds)
- **Priority Levels**: High, medium, low priority classifications
- **Implementation Effort**: Easy, moderate, complex effort indicators
- **Savings Calculation**: Shows potential savings in dollars and percentage

### 5. Cache Effectiveness Metrics (Requirement 23.59)
- **Hit/Miss Rates**: Visual representation of cache performance
- **Cost Savings**: Calculates money saved through caching
- **Response Time Comparison**: Shows speed improvements from cached vs uncached requests
- **Distribution Visualization**: Color-coded bar showing hit/miss ratio
- **Detailed Metrics**: Total requests, cache hits, cache misses

### 6. Automatic Cost Alert System (Requirement 23.60)
- **Configurable Thresholds**: Set alerts at 80%, 90%, 100% of budget
- **Real-time Monitoring**: Continuous tracking of budget usage
- **Visual Alerts**: Prominent alert cards when thresholds are approached
- **Status Indicators**: OK, warning, critical status levels
- **Action Buttons**: Quick access to configuration settings

### 7. ROI Analysis Calculator (Requirement 23.61)
- **Business Value Tracking**: Measures value generated by AI investments
- **Category Breakdown**: ROI by use case (document classification, medical analysis, forecasting, pricing)
- **Return Multiples**: Shows X times return on investment
- **Cost vs Value Charts**: Visual comparison of AI costs and business value
- **Detailed Descriptions**: Explains how each AI feature generates value

### 8. Model Efficiency Comparison (Requirement 23.62)
- **Multi-dimensional Comparison**: Cost, accuracy, speed metrics side-by-side
- **Efficiency Score**: Calculated score based on confidence, cost, and speed
- **Visual Indicators**: Color-coded badges for performance levels
- **Usage Statistics**: Total calls and cost per call for each model
- **Recommendations**: Suggests optimal model for different use cases

## Technical Implementation

### Components Used
- **Recharts**: For all data visualizations (line, bar, pie, area charts)
- **shadcn/ui**: Card, Button, Badge, Tabs components
- **Lucide Icons**: Comprehensive icon set for UI elements
- **Tailwind CSS**: Responsive styling with dark mode support

### Data Flow
1. **API Integration**: Fetches data from `/api/ai-control/cost-analytics` endpoint
2. **State Management**: Uses React hooks for local state
3. **Real-time Updates**: Refresh functionality to get latest data
4. **Time Range Selection**: Dynamic filtering by 7d, 30d, 90d periods

### Key Features
- **Responsive Design**: Works on mobile, tablet, and desktop
- **Dark Mode Support**: Full dark mode implementation
- **Export Functionality**: Ability to export cost reports
- **Interactive Charts**: Hover tooltips and legends
- **Performance Optimized**: Efficient rendering with ResponsiveContainer

## Usage

### Accessing the Page
Navigate to `/ai-control-center/cost-analytics` from the AI Control Center dashboard.

### Required Permissions
- User must have `ACCESS_AI_CONTROL_CENTER` permission
- Typically restricted to AI_ADMIN role

### Navigation
- **Back Button**: Returns to AI Control Center main page
- **Time Range Selector**: Switch between 7d, 30d, 90d views
- **Refresh Button**: Manually refresh all data
- **Export Button**: Download cost reports

### Tabs
1. **Cost Breakdown**: View costs by model, operation, and time
2. **Cache Metrics**: Analyze cache performance and savings
3. **Optimizations**: Review and implement cost-saving recommendations
4. **ROI Analysis**: Measure business value and return on investment
5. **Model Comparison**: Compare efficiency across different AI models

## Future Enhancements

### Planned Features
- Real-time WebSocket updates for live cost tracking
- Custom date range selection
- Cost forecasting with ML predictions
- Automated optimization implementation
- Budget allocation by department/team
- Cost anomaly detection
- Historical trend analysis
- Export to PDF/Excel with charts

### API Endpoints Needed
- `GET /api/ai-control/cost-analytics` - Main cost data
- `GET /api/ai-control/optimizations` - Optimization recommendations
- `GET /api/ai-control/cache-metrics` - Cache performance data
- `POST /api/ai-control/budget-alerts` - Configure alert thresholds
- `GET /api/ai-control/roi-metrics` - ROI calculation data

## Performance Considerations

- Charts use `ResponsiveContainer` for optimal rendering
- Data is fetched only when needed (on mount and refresh)
- Memoization can be added for expensive calculations
- Consider pagination for large datasets
- Implement data caching to reduce API calls

## Accessibility

- ARIA labels on all interactive elements
- Keyboard navigation support
- Color contrast meets WCAG AA standards
- Screen reader friendly
- Focus indicators on all focusable elements

## Testing Recommendations

1. **Unit Tests**: Test calculation functions (efficiency score, ROI, savings)
2. **Integration Tests**: Test API data fetching and state updates
3. **Visual Tests**: Verify chart rendering and responsiveness
4. **Accessibility Tests**: Run axe or similar tools
5. **Performance Tests**: Measure render times with large datasets

## Related Files

- `/app/ai-control-center/page.tsx` - Main AI Control Center dashboard
- `/components/ai-control/QuickStatsCards.tsx` - Reusable stat cards
- `/components/ai-control/ActivityMetrics.tsx` - Activity metrics component
- `/lib/auth/rbac.ts` - Permission checking
- `/store/authStore.ts` - Authentication state

## Documentation

For more information, see:
- [AI Control Center API Specification](/.kiro/specs/medical-archive-system/design-ai-control-center-api.md)
- [AI Control Center UI Design](/.kiro/specs/medical-archive-system/design-ai-control-center-ui.md)
- [Implementation Tasks](/.kiro/specs/medical-archive-system/tasks.md)
